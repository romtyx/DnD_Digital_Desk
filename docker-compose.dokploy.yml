services:
  backend:
    build:
      context: ./backend
    environment:
      DJANGO_DEBUG: "false"
      DJANGO_ALLOWED_HOSTS: "dnd.jkproduction.pro,backend"
      CORS_ALLOWED_ORIGINS: "https://dnd.jkproduction.pro"
      CSRF_TRUSTED_ORIGINS: "https://dnd.jkproduction.pro"
      # Database (external)
      DB_HOST: "${DB_HOST}"
      DB_PORT: "${DB_PORT}"
      DB_NAME: "${DB_NAME}"
      DB_USER: "${DB_USER}"
      DB_PASSWORD: "${DB_PASSWORD}"
      DJANGO_SECRET_KEY: "${DJANGO_SECRET_KEY}"
      # MinIO (private bucket)
      USE_S3: "true"
      S3_ENDPOINT_URL: "${S3_ENDPOINT_URL}"
      S3_ACCESS_KEY: "${S3_ACCESS_KEY}"
      S3_SECRET_KEY: "${S3_SECRET_KEY}"
      S3_BUCKET_NAME: "${S3_BUCKET_NAME}"
      S3_REGION: "${S3_REGION}"
      S3_SIGNATURE_VERSION: "s3v4"
      S3_ADDRESSING_STYLE: "path"
      S3_QUERYSTRING_AUTH: "${S3_QUERYSTRING_AUTH}"
      S3_QUERYSTRING_EXPIRE: "${S3_QUERYSTRING_EXPIRE}"
    ports:
      - "23992:8000"

  frontend:
    build:
      context: ./fronend
    environment:
      PORT: "3000"
      BACKEND_URL: "http://backend:8000"
      VITE_API_URL: "https://dnd.jkproduction.pro:8000/api"
    ports:
      - "23991:3000"
    depends_on:
      - backend
